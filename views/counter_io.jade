#header
  h1 mu:sync

#main-content-box
  h1#counter

script(type='text/javascript')

  var serverTime = 0;
  var localTime = 0;
  var timeDiff = 0;
  var steps = #{steps};

  $(document).ready(function() {
    var socket = new io.Socket();

    receiveTime = function(time) {
      timeDiff = ((new Date).getTime() - localTime) / 2;
      serverTime = time + timeDiff;
      $("#counter").html('' + (serverTime / steps) + ' + ' + timeDiff);
    };

    getTime = function() {
      localTime = (new Date).getTime();
      socket.send('ping');
    };

    socket.on('connect', function(){
      getTime();
    })

    socket.on('message', function(message){
      if(message.cmd == 'ping') {
        receiveTime(parseInt(message.data));
      }
    })
    socket.connect();

    setInterval(getTime, steps);
  });

